# OCR功能测试清单 - 自动AI解析版

## 🔧 准备工作
- [ ] 同步Gradle项目（Android Studio → Sync Project with Gradle Files）
- [ ] 配置AI模型（云端API或端侧模型）
- [ ] 确保设备已连接网络（首次使用需下载ML Kit模型）
- [ ] 使用真机测试（Android 11+推荐）

## 📱 核心测试场景

### 场景1: 悬浮球截图自动AI分析（核心功能）✨
- [ ] 启动应用
- [ ] 进入设置→开启辅助功能权限（Philotes助手）
- [ ] 点击FAB按钮确认悬浮球服务已启动
- [ ] 打开包含文字的页面（如会议通知、待办事项）
- [ ] 点击悬浮球触发截图

**预期流程**：
1. [ ] 显示"正在识别屏幕文字..."
2. [ ] 2-3秒后显示"✅ 识别成功\n\n正在AI分析..."
3. [ ] 1-2秒后显示"🎯 AI分析结果"
4. [ ] 显示解析的动作类型和参数（如"📅 创建日历事件"）
5. [ ] 显示"点击「执行」立即执行此动作"按钮
6. [ ] **无需跳转到主界面**，直接在悬浮卡片完成所有操作

**测试子场景**：

#### 1.1 日历事件识别
- [ ] 截取包含"明天下午3点开会"的文字
- [ ] **预期**: 显示"📅 创建日历事件"
- [ ] **预期**: 正确提取标题、时间、地点
- [ ] 点击「执行」按钮
- [ ] **预期**: 显示"正在执行..."
- [ ] **预期**: 显示"✅ 执行成功！"并创建日历事件
- [ ] **预期**: 3秒后悬浮卡片自动隐藏

#### 1.2 导航识别
- [ ] 截取包含"去机场"或地址的文字
- [ ] **预期**: 显示"🗺️ 导航到目的地"
- [ ] **预期**: 正确提取目的地
- [ ] 点击「执行」按钮
- [ ] **预期**: 打开地图应用并开始导航

#### 1.3 待办事项识别
- [ ] 截取包含"买牛奶"或任务的文字
- [ ] **预期**: 显示"✅ 添加待办事项"
- [ ] **预期**: 正确提取任务内容
- [ ] 点击「执行」按钮
- [ ] **预期**: 创建待办事项（或显示相应提示）

### 场景2: AI未配置的降级处理
- [ ] 清除AI配置（或使用未配置的设备）
- [ ] 点击悬浮球截图
- [ ] **预期**: 显示"✅ 识别成功\n\n[文本内容]\n\n⚠️ AI未配置"
- [ ] **预期**: 显示"点击「查看」跳转主界面手动解析"
- [ ] 点击「查看」按钮
- [ ] **预期**: 跳转到MainActivity，输入框已填充OCR文本

### 场景3: AI无法理解内容
- [ ] 截取纯数字或无意义文本
- [ ] **预期**: 完成OCR识别
- [ ] **预期**: 显示"⚠️ AI无法理解内容"
- [ ] **预期**: 提供跳转主界面选项

### 场景4: 多次连续使用
- [ ] 连续截图3-5次
- [ ] **预期**: 每次都正常工作
- [ ] **预期**: 无内存泄漏
- [ ] **预期**: 悬浮球状态正确切换

### 场景5: 分享图片识别（保持原逻辑）
- [ ] 从相册选择包含文字的图片
- [ ] 点击"分享"→选择"Philotes"
- [ ] **预期**: 跳转到MainActivity
- [ ] **预期**: 显示图片预览和OCR识别结果
- [ ] **预期**: 可手动点击"AI解析"按钮

## 📊 关键功能验证

### 工作流程完整性
- [ ] OCR识别 → AI解析 → 显示结果 → 执行动作（全流程无需用户跳转）
- [ ] 悬浮卡片显示内容清晰易懂
- [ ] 执行按钮响应正确
- [ ] 执行结果反馈及时

### 用户体验
- [ ] 整个流程耗时 < 10秒
- [ ] 进度提示清晰（识别中、分析中、执行中）
- [ ] 成功/失败反馈明确
- [ ] 自动隐藏时机合理

### 错误处理
- [ ] OCR失败时提示友好
- [ ] AI解析失败时提供降级方案
- [ ] 执行失败时提示明确错误原因
- [ ] 所有错误情况都有恢复路径

## 🔍 日志检查

在Logcat中搜索：
```
FloatingButtonService
MlKitOcrService
ActionParser
ActionExecutor
```

### 正常日志（应该看到）
```
I/FloatingButtonService: AI initialized with Cloud API: gpt-3.5-turbo
D/FloatingButtonService: Screenshot saved: /data/...
I/MlKitOcrService: OCR completed: 5 blocks
I/ActionParser: Parsing text...
I/ActionExecutor: Executing action: CREATE_CALENDAR
```

### 错误日志（不应该看到）
```
E/native: Failed to unlock pixels for bitmap  // ❌
E/MlKitOcrService: VisionKit pipeline returns empty result  // ❌
```

## ✅ 通过标准

### 核心功能
- [x] 悬浮球截图自动完成OCR和AI分析
- [x] 结果直接在悬浮卡片显示
- [x] 一键执行动作
- [x] 无需跳转到主界面（正常流程）
- [x] AI未配置时提供降级方案

### 用户体验
- [x] 整个流程流畅直观
- [x] 进度反馈清晰
- [x] 执行结果及时反馈
- [x] 自动隐藏时机合理

### 稳定性
- [x] 多次使用无崩溃
- [x] 无内存泄漏
- [x] 错误处理完善

## 🎯 新增功能亮点

1. **一站式体验**: 截图→识别→分析→执行，全程在悬浮卡片完成
2. **智能降级**: AI未配置时自动降级到手动模式
3. **实时反馈**: 每个步骤都有明确的进度提示
4. **自动隐藏**: 执行成功后自动隐藏，不打扰用户
5. **快速操作**: 3秒识别+2秒分析+1秒执行 = 6秒完成全流程

## 📝 测试记录

**测试日期**: ________________  
**测试人员**: ________________  
**设备信息**: ________________  
**AI配置**: ☐ 云端API  ☐ 端侧模型  ☐ 未配置  
**测试结果**: ☐ 通过  ☐ 失败  ☐ 部分通过

**问题记录**:
_______________________________________________________
_______________________________________________________
_______________________________________________________
